<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <h1>npm词典</h1>
  <input type="text" class="serach" oninput="input(this)"/>
  <ul class="result" id="result">
  </ul>


  <script src="./data.js"></script>
  <script>
    
    const container = document.getElementById('result')

    const render = data => {
      const fragment = document.createDocumentFragment()

      data.forEach(item => {
        const oldPackage = item.oldPackage;
        const package = item.package;
        const desc = item.desc;
        const key = item.key;
        const li = document.createElement('li');
        

        li.innerHTML = `<p>包名：<a target='_blank' href='https://www.npmjs.com/package/${oldPackage}'>${package}</a></p><p>作用描述：${desc}</p><p>关键字：${key.join('，')}</p>`

        fragment.append(li)
      })

      return fragment;
    }

    
    
    const input = ele => {
      const keyWorkd = ele.value;
      const result = []
      const reg = new RegExp(keyWorkd, 'g')


      data.forEach(item => {
        if (item.package.includes(keyWorkd) || item.desc.includes(keyWorkd) || item.key.includes(keyWorkd)) {
          let temp = JSON.stringify(item)
          temp = JSON.parse(temp.replace(reg, `<span>${keyWorkd}</span>`))
          temp.oldPackage = item.package
          result.push(temp)
        }
      })

      if (result.length && keyWorkd !== '') {
        container.innerHTML = ''
        container.append(render(result))
      } else {
        container.innerHTML = ''
      }
    }

  </script>
</body>

</html>